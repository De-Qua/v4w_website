<!DOCTYPE html>
<html>
<title>Venessia4working</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>

<style>
	body,h1 {font-family: "Open Sans", sans-serif}
	body, html {height: 100%}

		.bgimg {
		min-height: 100%;
		background-position: center;
		background-size: cover;
	}

	.bgimg:after {
    content : "";
    display: inline;
    position: absolute;
    top: 0;
    left: 0;
    background-image: url(venice-2451047_1920.jpg);
		background-position: center;
		background-size: cover;
    width: 100%;
    height: 100%;
    opacity : 0.2;
    z-index: -1;
}

	#mapid {
		height: 100%;
		width: 100%;
		z-index: +1;
		align-content: center;
		border: 1px solid;
	}
	.map {
		z-index: 1;
		opacity: 1;
	}
	.full_page {
		opacity: 1!important;
	}
	.searchbar {
		border: 5px solid blue;
		border-radius: 50px;
		height: 70vh;
		padding: 20px;
	}
	.mappa {
		padding: 10px;
		height: 70vh;
	}
	.footer {
		border: 10px inset aqua;
		height: 16.3vh;
		border-radius: 10px;
	}
	.bueae {
		border: 5px outset green;
		height: 70vh;
		border-radius: 20px;
		padding: 20px;
	}
</style>
<body>


	<div class="bgimg">
		<div class="full_page">

			<!-- header -->
			<div class="header w3-text w3-jumbo w3-center">
					DOVE NDEMO?

			</div>

			<!-- CENTRAL AREA -->
			<div class="w3-row">


			<!-- SEARCH BAR -->
			<div class="w3-col s2 searchbar">
				<p class="w3-text w3-center">
					DOVE VUOI ANDARE?
				</p>
				<br>
				<form action="." method="POST">
					Partimo da?<br>
					<textarea class="form-control" name="partenza" placeholder="Partenza" width="13%"></textarea><br>
					Rivemo a?<br>
					<textarea class="form-control" name="arrivo" placeholder="Partenza"></textarea><br>
					<br>
					<input type="submit" class="btn btn-success" value="ndemo">
     		</form>
				<br>
				&nbsp;
				<br>
				<div class="DEBUG">
					<b>DEBUG:</b><br>
					partenza: <i>{{start_name}}</i><br>
					arrivo: <i>{{stop_name}}</i><br>
					partenzax: <i>{{start_coordx}}</i><br>
					partenzay: <i>{{start_coordy}}</i><br>
					arrivox: <i>{{stop_coordx}}</i><br>
					arrivoy: <i>{{stop_coordy}}</i><br>
				</div>

			</div>

			<!-- MAPPA -->
			<div class="w3-col s8 mappa">
				<div id="mapid" class="w3-center">
					<!--
					<div id="topo" class="fakeMap" style="display: none;">
						<script style="display: none;">
							var mymap = L.map('mapid').setView([45.43, 12.33], 13);
							var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
								maxZoom: 22,
								attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
							}).addTo(mymap);
							var marker = L.marker([45.43, 12.33]).addTo(mymap);
						</script>
					</div>
					-->
					<div id="standard" class="fakeMap">
						<script>
							var mymap = L.map('mapid').setView([45.43, 12.33], 13);
							var OpenStreetMap_DE = L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
							maxZoom: 20,
							attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
							}).addTo(mymap);
							//var coords4326 = L.Projection.SphericalMercator.unproject([2311651.5, 5035091.7]);
							//var marker = L.marker([45.43, 12.33]).addTo(mymap);
						</script>
					</div>
					<!--
					<div id="dark" class="fakeMap">
						<script>
							//var mymap = L.map('mapid').setView([45.43, 12.33], 13);
							var Stadia_AlidadeSmoothDark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
								maxZoom: 20,
								attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
							});.addTo(mymap);
							var marker = L.marker([45.43, 12.33]).addTo(mymap);
						</script>
					</div>
					-->
				</div>
			</div>

			<!-- BUEAE -->
			<div class="w3-col s2 bueae">
				<div class="w3-text w3-center">
					<div class="w3-button w3-text w3-black" onclick="window.location.href='main'">PYTHON TEST</div>
					<br>&nbsp;<br>
					<div class="w3-button w3-text w3-red" onclick="draw_smth()">DISEGNA QUALCOSA</div>
					<br>&nbsp;<br>
					<div class="w3-button w3-text w3-indigo" onclick="change_map()">CAMBIA MAPPA<br>non funziona :(</div>
					<br>&nbsp;<br>
				</div>
			</div>
		</div>

		<!-- FOOTER -->
		<div class="w3-row footer w3-center">
			strada: <br><p class="w3-tiny"><i>{{path}}</i><br></p>
		</div>


	</div>
</div>
<script>
	function change_map() {
		var maps = document.getElementsByClassName("fakeMap")
		for (i = 0; i < maps.length; i++) {
			maps[i].style.display = "none";
		}
		var randnmr = Math.random();
		if (randnmr < 0.333) {
			document.getElementById("topo").style.display = "inline";
		}
		else if (randnmr < 0.666) {
			document.getElementById("standard").style.display = "inline";
		}
		else {
			document.getElementById("dark").style.display = "inline";
		}
	}
	function draw_smth() {
		var coin_throw = Math.random();
		if (coin_throw > 0.5) {
			draw_line();
		}
		else {
			draw_pol();
		}
	}
	function draw_pol() {
		var polygon = L.polygon([
			[45.43 + (Math.random() * 0.04 - 0.02), 12.33 + (Math.random() * 0.04 - 0.02)],
			[45.4389 + (Math.random() * 0.04 - 0.02), 12.3407 + (Math.random() * 0.04 - 0.02)],
			[45.4407 + (Math.random() * 0.04 - 0.02), 12.3313 + (Math.random() * 0.04 - 0.02)]
			]).addTo(mymap);
		}
	function draw_line() {
		var pointA = new L.LatLng(45.43 + (Math.random() * 0.05 - 0.025), 12.33 + (Math.random() * 0.05 - 0.025));
		var pointB = new L.LatLng(45.43 + (Math.random() * 0.05 - 0.025), 12.33 + (Math.random() * 0.05 - 0.025));
		var pointList = [pointA, pointB];

		var firstpolyline = new L.Polyline(pointList, {
				color: 'red',
				weight: 3,
				opacity: 0.5,
				smoothFactor: 1
		});
		firstpolyline.addTo(mymap);
	}
	var popup = L.popup();

			var pointList = [];
	function onMapClick(e) {
			var pointList = [e.latlng];
			popup
					.setLatLng(e.latlng)
					.setContent("Prima parte Sei andato a " + pointList.toString() + ", quando avremo le nostre fantastiche mappe ti diro anche dov'e!")
					.openOn(mymap);
			//var pointA = new L.LatLng(45.43, 12.33);
			if(pointList.length<1){
				pointList.push(e.latlng);
			} else {
					var pointList = [e.latlng];
			}
		var firstpolyline = new L.Polyline(pointList, {
				color: 'green',
				weight: 3,
				opacity: 0.5,
				smoothFactor: 1
			});
		firstpolyline.addTo(mymap);
	//	popup
			//.setLatLng(e.latlng)
			//.setContent("Sei andato a " + e.latlng.toString() + ", quando avremo le nostre fantastiche mappe ti diro anche dov'e!")
			//.openOn(mymap);
	}

	mymap.on('click', onMapClick);
	//change_map();

    // aggiungi i marker
    //var punto_di_partenza = L.point(stop_coordx, stop_coordy);
    //var prj = L.Projection.Mercator.unproject(pointM);
    var marker_arrivo = L.marker([{{stop_coordx}}, {{stop_coordy}}]).addTo(mymap);
    var marker_arrivo2 = L.marker([{{start_coordx}}, {{start_coordy}}]).addTo(mymap);
    //var testlucanum = document.getElementById("luca").innerHTML = ({{start_coord_x}} + 100).toString()
</script>

</body>
</html>
